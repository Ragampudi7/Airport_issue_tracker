<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Passenger Dashboard</h1>
    <div class="mode-toggle">
      <button 
        class="mode-btn" 
        [class.active]="isReportingMode" 
        (click)="toggleMode()">
        üìù Report Issue
      </button>
      <button 
        class="mode-btn" 
        [class.active]="!isReportingMode" 
        (click)="toggleMode()">
        üìã View Reports
      </button>
    </div>
  </div>

  <!-- Emergency SOS Button -->
  <div class="sos-section">
    <button class="sos-btn" (click)="goToSosPortal()">
      üö® Emergency SOS Portal
    </button>
    <p class="sos-description">For urgent medical, security, or safety issues</p>
  </div>

  <!-- Reporting Mode -->
  <div *ngIf="isReportingMode" class="reporting-section">
    <div class="section-header">
      <h2>Report an Issue</h2>
      <button class="btn btn-primary" (click)="toggleReportForm()">
        {{ showReportForm ? 'Cancel' : '+ Report Issue' }}
      </button>
    </div>

    <form *ngIf="showReportForm" [formGroup]="reportForm" (ngSubmit)="onSubmitReport()" class="report-form">
      <div class="form-row">
        <div class="form-group">
          <label for="title">Issue Title</label>
          <input type="text" id="title" formControlName="title" placeholder="Brief description of the issue">
          <div class="error" *ngIf="reportForm.get('title')?.invalid && reportForm.get('title')?.touched">
            Title is required
          </div>
        </div>
        <div class="form-group">
          <label for="location">Location</label>
          <input type="text" id="location" formControlName="location" placeholder="Where is this issue located?">
          <div class="error" *ngIf="reportForm.get('location')?.invalid && reportForm.get('location')?.touched">
            Location is required
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="sector">Sector</label>
          <select id="sector" formControlName="sector" (change)="onSectorChange()">
            <option value="">Select Sector</option>
            <option value="passenger_boarding">Boarding</option>
            <option value="passenger_arrivals">Arrivals</option>
          </select>
          <div class="error" *ngIf="reportForm.get('sector')?.invalid && reportForm.get('sector')?.touched">
            Sector is required
          </div>
        </div>
        <div class="form-group">
          <label for="subCategory">Category</label>
          <select id="subCategory" formControlName="subCategory" [disabled]="!reportForm.get('sector')?.value">
            <option value="">Select Category</option>
            <option *ngFor="let category of getSubCategories(reportForm.get('sector')?.value)" [value]="category">
              {{ category }}
            </option>
          </select>
          <div class="error" *ngIf="reportForm.get('subCategory')?.invalid && reportForm.get('subCategory')?.touched">
            Category is required
          </div>
        </div>
        <div class="form-group">
          <label for="priority">Priority</label>
          <select id="priority" formControlName="priority">
            <option value="low">Low</option>
            <option value="medium">Medium</option>
            <option value="high">High</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label for="description">Description</label>
        <textarea 
          id="description" 
          formControlName="description" 
          rows="4" 
          placeholder="Detailed description of the issue...">
        </textarea>
        <div class="error" *ngIf="reportForm.get('description')?.invalid && reportForm.get('description')?.touched">
          Description is required
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-outline" (click)="toggleReportForm()">Cancel</button>
        <button type="submit" class="btn btn-primary" [disabled]="reportForm.invalid || isLoading">
          {{ isLoading ? 'Submitting...' : 'Submit Issue' }}
        </button>
      </div>
    </form>
  </div>

  <!-- View Reports Mode -->
  <div *ngIf="!isReportingMode" class="reports-section">
    <div class="reports-grid">
      <!-- Red Column - Reported Issues -->
      <div class="reports-column red-column">
        <div class="column-header">
          <h3>üî¥ My Reported Issues ({{ redIncidents.length }})</h3>
        </div>
        <div class="incidents-list">
          <div *ngFor="let incident of redIncidents" class="incident-card">
            <div class="incident-header">
              <span class="priority-badge" [ngClass]="getPriorityClass(incident.priority)">
                {{ getPriorityLabel(incident.priority) }}
              </span>
              <span class="incident-time">{{ formatDate(incident.createdAt) }}</span>
            </div>
            <h4 class="incident-title">{{ incident.title }}</h4>
            <p class="incident-location">üìç {{ incident.location }}</p>
            <p class="incident-description">{{ incident.description }}</p>
            <div class="incident-meta">
              <span class="incident-sector">{{ incident.sector.replace('_', ' ') }}</span>
              <span class="incident-category">{{ incident.subCategory }}</span>
            </div>
            <div class="status-info">
              <span class="status-badge status-red">Under Review</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Green Column - Resolved Issues -->
      <div class="reports-column green-column">
        <div class="column-header">
          <h3>üü¢ Resolved Issues ({{ greenIncidents.length }})</h3>
        </div>
        <div class="incidents-list">
          <div *ngFor="let incident of greenIncidents" class="incident-card resolved">
            <div class="incident-header">
              <span class="priority-badge" [ngClass]="getPriorityClass(incident.priority)">
                {{ getPriorityLabel(incident.priority) }}
              </span>
              <span class="incident-time">{{ formatDate(incident.actualResolutionTime || incident.updatedAt) }}</span>
            </div>
            <h4 class="incident-title">{{ incident.title }}</h4>
            <p class="incident-location">üìç {{ incident.location }}</p>
            <p class="incident-description">{{ incident.description }}</p>
            <div class="incident-meta">
              <span class="incident-sector">{{ incident.sector.replace('_', ' ') }}</span>
              <span class="incident-category">{{ incident.subCategory }}</span>
            </div>
            <div class="status-info">
              <span class="status-badge status-green">Resolved</span>
            </div>
            <div class="resolution-notes" *ngIf="incident.resolutionNotes">
              <strong>Resolution:</strong> {{ incident.resolutionNotes }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
